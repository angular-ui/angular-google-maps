/*! angular-google-maps 0.0.0 2013-08-13
 *  AngularJS directives for Google Maps
 *  git: https://github.com/nlaplante/angular-google-maps.git
 */
!function(){var a=angular.module("google-maps",[]);a.factory("debounce",["$timeout",function(a){return function(b){var c=0;return function(){var d=this,e=arguments;c++;var f=function(a){return function(){return a===c?b.apply(d,e):void 0}}(c);return a(f,0,!0)}}}])}(),angular.module("google-maps").controller("PolylineDisplayController",["$scope",function(a){a.toggleStrokeColor=function(){a.stroke.color="#6060FB"==a.stroke.color?"red":"#6060FB"}}]),angular.module("google-maps").factory("array-sync",["add-events",function(a){return function(b,c,d){var e=c.$eval(d),f=a(b,{set_at:function(a){var c=b.getAt(a);e[a].latitude=c.lat(),e[a].longitude=c.lng()},insert_at:function(a){var c=b.getAt(a);e.splice(a,0,{latitude:c.lat(),longitude:c.lng()})},remove_at:function(a){e.splice(a,1)}}),g=c.$watch(d,function(a){var c=b;if(a){for(var d,e=0,f=c.getLength(),g=a.length,h=Math.min(f,g);h>e;e++){var i=c.getAt(e);d=a[e],(i.lat()!=d.latitude||i.lng()!=d.longitude)&&c.setAt(e,new google.maps.LatLng(d.latitude,d.longitude))}for(;g>e;e++)d=a[e],c.push(new google.maps.LatLng(d.latitude,d.longitude));for(;f>e;e++)c.pop()}},!0);return function(){f&&(f(),f=null),g&&(g(),g=null)}}}]),angular.module("google-maps").factory("add-events",["$timeout",function(a){function b(b,c,d){return google.maps.event.addListener(b,c,function(){d.apply(this,arguments),a(function(){},!0)})}function c(a,c,d){if(d)return b(a,c,d);var e=[];return angular.forEach(c,function(c,d){console.log("adding listener: "+d+": "+c.toString()+" to : "+a),e.push(b(a,d,c))}),function(){angular.forEach(e,function(a){a()}),e=null}}return c}]),angular.module("google-maps").directive("googleMap",["$log","$timeout",function(a,b){"use strict";function c(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}var d={mapTypeId:google.maps.MapTypeId.ROADMAP};return{restrict:"ECMA",transclude:!0,replace:!1,template:'<div class="angular-google-map"><div class="angular-google-map-container"></div><div ng-transclude style="display: none"></div></div>',scope:{center:"=center",zoom:"=zoom",dragging:"=dragging",markers:"=markers",refresh:"&refresh",windows:"=windows",events:"=events",bounds:"=bounds"},controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(e,f,g){if(!angular.isDefined(e.center)||!angular.isDefined(e.center.latitude)||!angular.isDefined(e.center.longitude))return a.error("angular-google-maps: could not find a valid center property"),void 0;if(!angular.isDefined(e.zoom))return a.error("angular-google-maps: map zoom property not set"),void 0;var h=angular.element(f);h.addClass("angular-google-map");var i={options:{}};if(g.options&&(i.options=angular.fromJson(g.options)),g.type){var j=g.type.toUpperCase();google.maps.MapTypeId.hasOwnProperty(j)?i.mapTypeId=google.maps.MapTypeId[g.type.toUpperCase()]:a.error('angular-google-maps: invalid map type "'+g.type+'"')}var k=new google.maps.Map(h.find("div")[1],angular.extend({},d,i,{center:new google.maps.LatLng(e.center.latitude,e.center.longitude),draggable:c(g.draggable),zoom:e.zoom,bounds:e.bounds})),l=!1;google.maps.event.addListener(k,"dragstart",function(){l=!0,b(function(){e.$apply(function(a){a.dragging=l})})}),google.maps.event.addListener(k,"dragend",function(){l=!1,b(function(){e.$apply(function(a){a.dragging=l})})}),google.maps.event.addListener(k,"drag",function(){var a=k.center;b(function(){e.$apply(function(b){b.center.latitude=a.lat(),b.center.longitude=a.lng()})})}),google.maps.event.addListener(k,"zoom_changed",function(){e.zoom!=k.zoom&&b(function(){e.$apply(function(a){a.zoom=k.zoom})})});var m=!1;if(google.maps.event.addListener(k,"center_changed",function(){var a=k.center;m||b(function(){e.$apply(function(b){k.dragging||(b.center.latitude!==a.lat()&&(b.center.latitude=a.lat()),b.center.longitude!==a.lng()&&(b.center.longitude=a.lng()))})})}),google.maps.event.addListener(k,"idle",function(){var a=k.getBounds(),c=a.getNorthEast(),d=a.getSouthWest();b(function(){e.$apply(function(a){null!==a.bounds&&void 0!==a.bounds&&void 0!==a.bounds&&(a.bounds.northeast={latitude:c.lat(),longitude:c.lng()},a.bounds.southwest={latitude:d.lat(),longitude:d.lng()})})})}),angular.isDefined(e.events)&&null!==e.events&&angular.isObject(e.events)){var n=function(a){return function(){e.events[a].apply(e,[k,a,arguments])}};for(var o in e.events)e.events.hasOwnProperty(o)&&angular.isFunction(e.events[o])&&google.maps.event.addListener(k,o,n(o))}e.map=k,google.maps.event.trigger(k,"resize"),angular.isUndefined(e.refresh())||e.$watch("refresh()",function(a,b){if(a&&!b){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}}),e.$watch("center",function(a,b){if(a!==b){if(m=!0,!l){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}m=!1}},!0),e.$watch("zoom",function(a,b){a!==b&&k.setZoom(a)}),e.$watch("bounds",function(a,b){if(a!==b){var c=new google.maps.LatLng(a.northeast.latitude,a.northeast.longitude),d=new google.maps.LatLng(a.southwest.latitude,a.southwest.longitude),e=new google.maps.LatLngBounds(d,c);k.fitBounds(e)}})}}}]),angular.module("google-maps").directive("marker",["$log","$timeout",function(a,b){"use strict";function c(a){return-1!==["false","FALSE",0,"n","N","no","NO"].indexOf(a)}var d={animation:google.maps.Animation.DROP};return{restrict:"ECMA",require:"^googleMap",priority:-1,transclude:!0,template:'<span class="angular-google-map-marker" ng-transclude></span>',replace:!0,scope:{coords:"=coords",icon:"=icon",click:"&click"},controller:function(a,b){this.getMarker=function(){return b.data("instance")}},link:function(e,f,g,h){return angular.isUndefined(e.coords)||null===e.coords||angular.isUndefined(e.coords.latitude)||angular.isUndefined(e.coords.longitude)?(a.error("marker: no valid coords attribute found"),void 0):(b(function(){var a=angular.extend({},d,{position:new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map:h.getMap(),icon:e.icon,visible:null!==e.coords.latitude&&null!==e.coords.longitude});angular.isDefined(g.animate)&&c(g.animate)&&delete a.animation;var i=new google.maps.Marker(a);f.data("instance",i),google.maps.event.addListener(i,"click",function(){angular.isDefined(g.click)&&null!==e.click&&b(function(){e.click()})}),e.$watch("coords",function(a,b){a!==b&&(a?(i.setMap(h.getMap()),i.setPosition(new google.maps.LatLng(a.latitude,a.longitude)),i.setVisible(null!==a.latitude&&null!==a.longitude)):i.setMap(null))},!0),e.$watch("icon",function(a,b){a!==b&&(i.icon=a,i.setMap(null),i.setMap(h.getMap()),i.setPosition(new google.maps.LatLng(e.coords.latitude,e.coords.longitude)),i.setVisible(null!==e.coords.latitude&&null!==e.coords.longitude))},!0),e.$on("$destroy",function(){i.setMap(null)})}),void 0)}}}]),angular.module("google-maps").directive("polyline",["$log","$timeout","array-sync",function(a,b,c){"use strict";function d(a){for(var b=0;b<a.length;b++)if(angular.isUndefined(a[b].latitude)||angular.isUndefined(a[b].longitude))return!1;return!0}function e(a){for(var b=new google.maps.MVCArray,c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c].latitude,a[c].longitude));return b}function f(a,b){for(var c=new google.maps.LatLngBounds,d=0;d<b.length;d++)c.extend(b.getAt(d));a.fitBounds(c)}function g(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}var h={};return{restrict:"ECA",require:"^googleMap",scope:{path:"=path",stroke:"=stroke",clickable:"=",draggable:"=",editable:"=",geodesic:"=",icons:"=icons",visible:"="},link:function(i,j,k,l){return angular.isUndefined(i.path)||null===i.path||i.path.length<2||!d(i.path)?(a.error("polyline: no valid path attribute found"),void 0):(b(function(){function a(a){var c=angular.extend({},h,{map:b,path:a,strokeColor:i.stroke&&i.stroke.color,strokeOpacity:i.stroke&&i.stroke.opacity,strokeWeight:i.stroke&&i.stroke.weight});return angular.forEach({clickable:!0,draggable:!1,editable:!1,geodesic:!1,visible:!0},function(a,b){c[b]=angular.isUndefined(i[b])||null===i[b]?a:i[b]}),c}var b=l.getMap(),d=new google.maps.Polyline(a(e(i.path)));g(k.fit)&&f(b,pathPoints),angular.isDefined(i.editable)&&i.$watch("editable",function(a){d.setEditable(a)}),angular.isDefined(i.draggable)&&i.$watch("draggable",function(a){d.setDraggable(a)}),angular.isDefined(i.visible)&&i.$watch("visible",function(a){d.setVisible(a)}),angular.isDefined(i.geodesic)&&i.$watch("geodesic",function(){d.setOptions(a(d.getPath()))}),angular.isDefined(i.stroke)&&angular.isDefined(i.stroke.weight)&&i.$watch("stroke.weight",function(){d.setOptions(a(d.getPath()))}),angular.isDefined(i.stroke)&&angular.isDefined(i.stroke.color)&&i.$watch("stroke.color",function(){d.setOptions(a(d.getPath()))});var j=c(d.getPath(),i,"path");i.$on("$destroy",function(){d.setMap(null),j&&(j(),j=null)})}),void 0)}}}]),angular.module("google-maps").directive("window",["$log","$timeout","$compile","$http","$templateCache",function(a,b,c,d,e){"use strict";var f={};return{restrict:"ECMA",template:'<span class="angular-google-maps-window" ng-transclude></span>',transclude:!0,priority:-100,require:["^googleMap","^?marker"],scope:{coords:"=coords",show:"=show",templateUrl:"=templateurl",templateParameter:"=templateparameter",isIconVisibleOnClick:"=isiconvisibleonclick",closeClick:"&closeclick",openClick:"&openclick"},link:function(a,g,h,i){b(function(){function b(){a.templateUrl?d.get(a.templateUrl,{cache:e}).then(function(b){var d=a.$new();angular.isDefined(a.templateParameter)&&(d.parameter=a.templateParameter);var e=c(b.data)(d);o.setContent(e.get(0)),o.open(l.getMap())}):o.open(l.getMap())}function j(){o.close()}var k=!0;angular.isDefined(h.isiconvisibleonclick)&&(k=a.isIconVisibleOnClick);var l=i[0],m=i.length>1?i[1]:null,n=angular.extend({},f,{content:g.html(),position:angular.isDefined(m)?m.getMarker().getPosition():new google.maps.LatLng(a.coords.latitude,a.coords.longitude)}),o=new google.maps.InfoWindow(n);if(angular.isDefined(m)){var p=m.getMarker();p.setClickable(!0);var q;google.maps.event.addListener(p,"click",function(){a.openClick(),o.setPosition(p.getPosition()),o.open(l.getMap()),q=p.getVisible(),p.setVisible(k),a.show=!0,a.$apply()}),google.maps.event.addListener(o,"closeclick",function(){p.setVisible(q),a.closeClick()})}a.$watch("show",function(a,c){a!==c?a?b():j():a&&!o.getMap()&&b()},!0)},50)}}}]),angular.module("google-maps").directive("trafficlayer",["$log","$timeout",function(a,b){"use strict";return{restrict:"ECMA",require:"^googleMap",priority:-1,transclude:!0,template:'<span class="angular-google-map-trafficlayer" ng-transclude></span>',replace:!0,scope:{show:"=show"},link:function(a,c,d,e){var f,g=new google.maps.TrafficLayer,h=!0;b(function(){f=e.getMap(),angular.isDefined(d.show)&&(h=a.show),null!==h&&h&&null!==f&&g.setMap(f),a.$watch("show",function(a,b){a!==b&&(h=a,a?g.setMap(f):g.setMap(null))},!0),a.$on("$destroy",function(){g.setMap(null)})})}}}]);