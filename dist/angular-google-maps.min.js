/*! angular-google-maps 0.0.0 2013-06-11
 *  AngularJS directives for Google Maps
 *  git: https://github.com/nlaplante/angular-google-maps.git
 */
angular.module("google-maps",[]),angular.module("google-maps").directive("googleMap",["$log","$timeout",function(a,b){"use strict";function c(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}var d={mapTypeId:google.maps.MapTypeId.ROADMAP};return{restrict:"ECMA",transclude:!0,replace:!1,template:'<div class="angular-google-map"><div class="angular-google-map-container"></div><div ng-transclude style="display: none"></div></div>',scope:{center:"=center",zoom:"=zoom",markers:"=markers",refresh:"&refresh",windows:"=windows",events:"=events"},controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(e,f,g){if(!angular.isDefined(e.center)||!angular.isDefined(e.center.latitude)||!angular.isDefined(e.center.longitude))return a.error("angular-google-maps: could not find a valid center property"),void 0;if(!angular.isDefined(e.zoom))return a.error("angular-google-maps: map zoom property not set"),void 0;var h=angular.element(f);h.addClass("angular-google-map");var i={options:{}};if(g.options&&(i.options=angular.fromJson(g.options)),g.type){var j=g.type.toUpperCase();google.maps.MapTypeId.hasOwnProperty(j)?i.mapTypeId=google.maps.MapTypeId[g.type.toUpperCase()]:a.error('angular-google-maps: invalid map type "'+g.type+'"')}var k=new google.maps.Map(h.find("div")[1],angular.extend({},d,i,{center:new google.maps.LatLng(e.center.latitude,e.center.longitude),draggable:c(g.draggable),zoom:e.zoom})),l=!1;if(google.maps.event.addListener(k,"dragstart",function(){l=!0}),google.maps.event.addListener(k,"dragend",function(){l=!1}),google.maps.event.addListener(k,"drag",function(){var a=k.center;b(function(){e.$apply(function(b){b.center.latitude=a.lat(),b.center.longitude=a.lng()})})}),google.maps.event.addListener(k,"zoom_changed",function(){e.zoom!=k.zoom&&b(function(){e.$apply(function(a){a.zoom=k.zoom})})}),google.maps.event.addListener(k,"center_changed",function(){var a=k.center;b(function(){e.$apply(function(b){k.dragging||(b.center.latitude=a.lat(),b.center.longitude=a.lng())})})}),angular.isDefined(e.events)&&null!==e.events&&angular.isObject(e.events)){var m=function(a){return function(){e.events[a].apply(e,[k,a,arguments])}};for(var n in e.events)e.events.hasOwnProperty(n)&&angular.isFunction(e.events[n])&&google.maps.event.addListener(k,n,m(n))}e.map=k,google.maps.event.trigger(k,"resize"),angular.isUndefined(e.refresh())||e.$watch("refresh()",function(a,b){if(a&&!b){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}}),e.$watch("center",function(a,b){if(a!==b&&!l){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}},!0),e.$watch("zoom",function(a,b){a!==b&&k.setZoom(a)})}}}]),angular.module("google-maps").directive("marker",["$log","$timeout",function(a,b){"use strict";function c(a){return-1!==["false","FALSE",0,"n","N","no","NO"].indexOf(a)}var d={animation:google.maps.Animation.DROP};return{restrict:"ECMA",require:"^googleMap",priority:-1,transclude:!0,template:'<span class="angular-google-map-marker" ng-transclude></span>',replace:!0,scope:{coords:"=coords",click:"&click"},controller:function(a,b){this.getMarker=function(){return b.data("instance")}},link:function(e,f,g,h){return angular.isUndefined(e.coords)||null===e.coords||angular.isUndefined(e.coords.latitude)||angular.isUndefined(e.coords.longitude)?(a.error("marker: no valid coords attribute found"),void 0):(b(function(){var a=angular.extend({},d,{position:new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map:h.getMap(),visible:null!==e.coords.latitude&&null!==e.coords.longitude});angular.isDefined(g.animate)&&c(g.animate)&&delete a.animate;var b=new google.maps.Marker(a);f.data("instance",b),e.$watch("coords",function(a,c){a!==c&&(a?(b.setMap(h.getMap()),b.setPosition(new google.maps.LatLng(a.latitude,a.longitude)),b.setVisible(null!==a.latitude&&null!==a.longitude)):b.setMap(null))},!0),e.$on("$destroy",function(){b.setMap(null)})}),void 0)}}}]),angular.module("google-maps").directive("polyline",["$log","$timeout",function(){"use strict";return{restrict:"ECA",require:"^googleMap",scope:{},link:function(a,b,c,d){d.getMap()}}}]),angular.module("google-maps").directive("window",["$log","$timeout","$compile","$http","$templateCache",function(a,b,c,d,e){"use strict";var f={};return{restrict:"ECMA",template:'<span class="angular-google-maps-window" ng-transclude></span>',transclude:!0,priority:-100,require:["^googleMap","^?marker"],scope:{coords:"=coords",show:"&show",templateUrl:"=templateurl",templateParameter:"=templateparameter"},link:function(a,g,h,i){b(function(){function b(){a.templateUrl?d.get(a.templateUrl,{cache:e}).then(function(b){var d=a.$new();angular.isDefined(a.templateParameter)&&(d.parameter=a.templateParameter);var e=c(b.data)(d);m.setContent(e.get(0)),m.open(j.getMap())}):m.open(j.getMap())}function h(){m.close()}var j=i[0],k=i.length>1?i[1]:null,l=angular.extend({},f,{content:g.html(),position:angular.isDefined(k)?k.getMarker().getPosition():new google.maps.LatLng(a.coords.latitude,a.coords.longitude)}),m=new google.maps.InfoWindow(l);if(angular.isDefined(k)){var n=k.getMarker();n.setClickable(!0);var o;google.maps.event.addListener(n,"click",function(){m.setPosition(n.getPosition()),m.open(j.getMap()),o=n.getVisible(),n.setVisible(!1)}),google.maps.event.addListener(m,"closeclick",function(){n.setVisible(o)})}a.$watch("show()",function(a,c){a!==c?a?b():h():a&&!m.getMap()&&b()})},50)}}}]);